
/*
********************************************************************************
                                延时程序

文件名    ：delay.c
版本      ：
程序员    ：TK_CG
********************************************************************************
说明：精确延时程序
********************************************************************************
*/


/*
********************************************************************************
                                    头文件
********************************************************************************
*/
#include "delay.h"


/*
********************************************************************************
                                Delay_Ms(u16 time)

描述：     精确毫秒级延时
参数：     time，需要延时的时间单位ms
返回值：    无
********************************************************************************
*/
void Delay_Ms(uint16_t time)
{  
 
  while(time--)
   {
     Delay_us(1000);
   }
}

/*
********************************************************************************
                                void Delay_us(uint32 n)

描述：     微秒级精确延时函数
参数：     n，需要延时的时间单位us
返回值：    无
********************************************************************************
*/
void Delay_us(uint16_t n){
  SysTick->LOAD=72*n;                   //装载计数值，因为时钟72M，72次在1μs
  SysTick->CTRL=0x00000005;             //时钟来源设为为HCLK(72M)，打开定时器
  while(!(SysTick->CTRL&0x00010000));   //等待计数到0
  SysTick->CTRL=0x00000004;             //关闭定时器
}


/*
********************************************************************************
                   Delay_RoughMs(uint16_t time)

描述：     非精确毫秒级延时
参数：     time，需要延时的时间单位ms
返回值：    无
********************************************************************************
*/

void Delay_RoughMs(uint16_t nCount)
{
	uint16_t Time;
	Time = (uint32_t)(nCount*((double)1000000/126));
	while(--Time);
}

/*
********************************************************************************
                   void Delay_RoughUs(uint32 nCount)

描述：     微秒非精确延时函数
参数：     n，需要延时的时间单位us
返回值：    无
********************************************************************************
*/

void Delay_RoughUs(uint16_t nCount)
{
  uint32_t Time;
  Time = (uint32_t)(nCount*((double)1000/126));
  while(--Time);
}


